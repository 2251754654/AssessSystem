@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>管理员视图</title>
    <!--引入JQuery库-->
    <script src="@Url.Content("~/Scripts/jquery-3.3.1.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.form.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/bootstrap.min.js")" type="text/javascript"></script>
    <!--前端框架-->
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/bootstrap.css" rel="stylesheet" type="text/css" />

    <script src="~/Scripts/jquery-ui.js"></script>
    <link href="~/Content/jquery-ui.css" rel="stylesheet" />
    <link href="~/Content/jquery-ui.theme.css" rel="stylesheet" />
    <link href="~/Content/jquery-ui.structure.css" rel="stylesheet" />

    <!--自定义样式和脚本-->
    <script src="~/Scripts/JSAdministratorPage/AddRoleByAJAX.js"></script>
    <link href="~/Content/CSSAdministratorPage/AdministratorPage.css" rel="stylesheet" type="text/css" />


</head>
<body class="text-center">
    <header class="page-header">
        <h3 >欢迎你管理员</h3>
        <h5 >&lt;&lt;&lt; 通过左边功能管理系统</h5>
    </header>
    <div class="Mecontainer " >
        <div class="row">
            <aside class="col-lg-2 list-group">
                <ul id="browser ">
                    <li>
                        <ul class="System">
                            <li>
                                <span class="list-group-item active" onclick="RoleManagement()">角色管理</span>
                                <ul class="RoleList">
                                    <li class="list-group-item"><a href="javascript:void(0);" onclick="InsertRole()">添加角色</a></li>
                                    <li class="list-group-item"><a href="javascript:void(0);" onclick="FindRole(1)">查询角色</a></li>
                                </ul>
                            </li>
                            <li>
                                <span class="list-group-item active" onclick="ProfessionalManagement()">职业管理</span>
                                <ul class="ProfessionalList">
                                    <li class="list-group-item"><a href="~/GetAdministratorPage/InsertProfessional">添加职业</a></li>
                                    <li class="list-group-item"><a href="~/GetAdministratorPage/DeleteProfessional">删除职业</a></li>
                                    <li class="list-group-item"><a href="~/GetAdministratorPage/UpdateProfessional">更新职业</a></li>
                                    <li class="list-group-item"><a href="~/GetAdministratorPage/SelectProfessional">查询职业</a></li>
                                </ul>
                            </li>
                            <li>
                                <span class="list-group-item active" onclick="CoreSkilllManagement()">核心技能</span>
                                <ul class="CoreSkilllList">
                                    <li class="list-group-item"> <a href="~/GetAdministratorPage/InsertCoreSkill">添加核心技能</a></li>
                                    <li class="list-group-item"> <a href="~/GetAdministratorPage/DeleteCoreSkill">删除核心技能</a></li>
                                    <li class="list-group-item"> <a href="~/GetAdministratorPage/UpdateCoreSkill">更新核心技能</a></li>
                                    <li class="list-group-item"> <a href="~/GetAdministratorPage/SelectCoreSkill">查询核心技能</a></li>
                                </ul>
                            </li>
                            <li>
                                <span class="list-group-item active" onclick="TeachSkillManagement()">专业技能</span>
                                <ul class="TeachSkillList">
                                    <li class="list-group-item"><a href="~/GetAdministratorPage/InsertTeachSkill">添加专业技能</a></li>
                                    <li class="list-group-item"><a href="~/GetAdministratorPage/DeleteTeachSkill">删除专业技能</a></li>
                                    <li class="list-group-item"><a href="~/GetAdministratorPage/UpdateTeachSkill">更新专业技能</a></li>
                                    <li class="list-group-item"><a href="~/GetAdministratorPage/SelectTeachSkill">查询专业技能</a></li>
                                </ul>
                            </li>
                            <li>
                                <span class="list-group-item active" onclick="PositionManagement()">职务管理</span>
                                <ul class="Position">
                                    <li class="list-group-item">
                                        <a href="~/Home/HomePage">返回主页</a>
                                    </li>
                                    <li class="list-group-item">
                                        <a href="~/Home/Logout">退出系统</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </aside>
            <section class="col-lg-9">
                <div id="AddRoleDiv">
                    <!-- 按钮触发模态框 -->
                    <!--树形插件触发模态框-->
                    <!-- 模态框（Modal） -->
                    <div class="modal fade" id="AddRole" tabindex="-1" role="dialog" aria-labelledby="AddRoleLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="AddRoleLabel" style="text-align:center">添加角色</h4>
                                </div>
                                <div class="modal-body">
                                    RoleName:&nbsp;<input type="text" name="RoleName" value="架构和需求分析师" /><br />

                                    RoleDetails:<input type="text" name="RoleDetails" value="同时兼任两个职位" />
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="AddRoleButton()">添加</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                </div>
                <div id="UpdateRoleDiv">
                    <!-- 按钮触发模态框 -->
                    <!--树形插件触发模态框-->
                    <!-- 模态框（Modal） -->
                    <div class="modal fade" id="UpdateRole" tabindex="-1" role="dialog" aria-labelledby="UpdateRoleLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="UpdateRoleLabel">您要更新的角色信息</h4>
                                </div>
                                <div class="modal-body">
                                    RoleName:&nbsp;<input id="UpdateRoleName" type="text" name="RoleName" value="" /><br />
                                    RoleDetails:<input id="UpdateRoleDetails" type="text" name="RoleDetails" value="" />
                                    <input id="UpdateRoleID" type="hidden" name="RoleID" value="" />
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="UpdateRoleButton()">添加</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                </div>
               
                <table class="table table-bordered">
                    @*<caption><h3>角色信息表</h3></caption>*@
                    <thead>
                        <tr class="success"><td>角色ID</td><td>角色名</td><td>角色描述</td><td>更新</td></tr>
                    </thead>
                    <tbody id="tbodyContent"></tbody>
                </table>
                <ul ondragover="PutDown(event)" ondrop="drop(event)" id="PutDownDelete" class="list-group text-danger pre-scrollable ">
                    <li id="TagFirst"><a href="#" class="list-group-item active" onclick="DeleteAllRole()">全部删除</a></li>
                </ul>
                <p id="PageListP" style="display:block;text-align:center;"></p>
            </section>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    //全局变量存储需要删除的角色数据组
    var roleArray = new Array();
    function FindRole(page) {
        $.ajax({
            url: '/GetAdministratorPage/SelectRole?page=' + page + '',
            type: 'post',
            success: function (result) {
                //请求的数据插入到表格
                $("#tbodyContent").html("");
                $("#PageListP").html("");
                $(".H123456").hide();
                var item = 0;
                for (; item < result.length - 1; item++) {
                    $("#tbodyContent").append("<tr id=" + (item + 1) + " draggable='true' ondragstart='DeleteThis(event)'><td>" + result[item].RoleID + "</td><td>" + result[item].RoleName + "</td><td>" + result[item].RoleDetails + "</td><td><a href='javascript:void(0);'onclick='UpdateModalRole(" + JSON.stringify(result[item]) + ")'>更新</a></td></tr>");
                }
                for (var num = 1; num <= result[result.length - 1].RoleID; num++) {
                    $("#PageListP").append('<a href="javascript:void(0);" onclick="FindRole(' + num + ')">第 ' + num + '页</a>');
                }
            },
        }).done().fail(function () {
            alert("网络连接错误！");
        });

    }
    function DeleteThis(event) {
        event.dataTransfer.setData("Text", event.target.id);
    }
    //放置接收到的数据
    function PutDown(event) {
        event.preventDefault();
    }
    function drop(event) {

        event.preventDefault();
        var data = event.dataTransfer.getData("Text");
        var roleID = $("#" + data + "").children().eq(0).text();
        var roleName = $("#" + data + "").children().eq(1).text();
        roleArray.push(roleID);
        $("#PutDownDelete").append('<li class="list-group-item">您将要删除的ID为：' + roleID + ',角色名为：' + roleName + '.<span class="badge">删</span></li>');
        //点击确定后操作
        //数据库删除
    }
    //更新模态框接受数据
    function UpdateModalRole(role) {
        //将数据传给模态框
        $("#UpdateRoleID").val(role.RoleID);
        $("#UpdateRoleName").val(role.RoleName);
        $("#UpdateRoleDetails").val(role.RoleDetails);
        $('#UpdateRole').modal('show');
    }
    //更新模态框提交数据
    function UpdateRoleButton() {
        var roleID = $("#UpdateRoleID").val();
        var roleName = $("#UpdateRoleName").val();
        var roleDetails = $("#UpdateRoleDetails").val();
        $.ajax({
            url: '/GetAdministratorPage/UpdateRole',
            type: 'post',
            data: { RoleName:roleName,RoleDetails:roleDetails,RoleID: roleID},
            success: function (result) {
                if (result === false) {
                    alert("更新失败！");
                } else {
                    alert("更新成功！");
                    $(this).modal("hide");
                }
            }
        }).done().fail(function () {
            alert("网络连接错误！");
        });
    }
    //批量删除角色
    
    function DeleteAllRole() {
        if (confirm("确认全部删除？")) {
            $.ajax({
                url: '/GetAdministratorPage/DeleteRole',
                type: 'post',
                data: { Data: roleArray },
                success: function (result) {
                    if (result === false) {
                        alert("删除失败！");
                    } else {
                        alert("删除成功！");
                        $("#TagFirst").nextAll().html("");
                    }
                }
            });
        }
    }
</script>

